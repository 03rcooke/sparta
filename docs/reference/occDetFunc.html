<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Occupancy detection Function — occDetFunc â€¢ sparta</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">sparta</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/sparta_vignette.html">sparta - Species Presence/Absence R Trends Analyses</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Occupancy detection Function</h1>
    </div>

    
    <p>Run occupancy detection models using the output from <code>formatOccData</code></p>
    

    <pre class="usage"><span class='fu'>occDetFunc</span>(<span class='no'>taxa_name</span>, <span class='no'>occDetdata</span>, <span class='no'>spp_vis</span>, <span class='kw'>n_iterations</span> <span class='kw'>=</span> <span class='fl'>5000</span>, <span class='kw'>nyr</span> <span class='kw'>=</span> <span class='fl'>2</span>,
  <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>1500</span>, <span class='kw'>thinning</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>n_chains</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>write_results</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>output_dir</span> <span class='kw'>=</span> <span class='fu'>getwd</span>(), <span class='kw'>modeltype</span> <span class='kw'>=</span> <span class='st'>"sparta"</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>model.function</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>regional_codes</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>region_aggs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>additional.parameters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>additional.BUGS.elements</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>additional.init.values</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>return_data</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>taxa_name</th>
      <td><p>A character giving the name of the species to be modelled.</p></td>
    </tr>
    <tr>
      <th>occDetdata</th>
      <td><p>The 2nd element of the object returned by formatOccData.</p></td>
    </tr>
    <tr>
      <th>spp_vis</th>
      <td><p>The 1st element of the object returned by formatOccData.</p></td>
    </tr>
    <tr>
      <th>n_iterations</th>
      <td><p>numeric, An MCMC parameter - The number of interations</p></td>
    </tr>
    <tr>
      <th>nyr</th>
      <td><p>numeric, the minimum number of years on which a site must have records for it
to be included in the models. Defaults to 2</p></td>
    </tr>
    <tr>
      <th>burnin</th>
      <td><p>numeric, An MCMC parameter - The length of the burn in</p></td>
    </tr>
    <tr>
      <th>thinning</th>
      <td><p>numeric, An MCMC parameter - The thinning factor</p></td>
    </tr>
    <tr>
      <th>n_chains</th>
      <td><p>numeric, an MCMC parameter - The number of chains to be run</p></td>
    </tr>
    <tr>
      <th>write_results</th>
      <td><p>logical, should results be saved to <code>output_dir</code>. This is
recommended since these models can take a long time to run. If <code>TRUE</code> (default)
the results from each species will be saved as an .rdata file once the species
has run. This prevents loss of data should anything go wrong.</p></td>
    </tr>
    <tr>
      <th>output_dir</th>
      <td><p>character, the output directory were the output for each taxa will be saved
as .rdata files. This will defualt to the working directory</p></td>
    </tr>
    <tr>
      <th>modeltype</th>
      <td><p>A character string or vector of strings that specifies the model to use. See details. If
used then model.function is ignored.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>numeric, uses <code>set.seed</code> to set the randon number seed. Setting
this number ensures repeatabl analyses</p></td>
    </tr>
    <tr>
      <th>model.function</th>
      <td><p>optionally a user defined BUGS model coded as a function (see <code>?jags</code>,
including the example there, for how this is done)</p></td>
    </tr>
    <tr>
      <th>regional_codes</th>
      <td><p>A data.frame object detailing which site is associated with which region.
each row desginates a site and each column represents a region. The first column represents the 
site name (as in <code>site</code>). Subsequent columns are named for each regions with 1 representing
the site is in that region and 0 that it is not. NOTE a site should only be in one region</p></td>
    </tr>
    <tr>
      <th>region_aggs</th>
      <td><p>A named list giving aggregations of regions that you want trend
estimates for. For example <code>region_aggs = list(GB = c('england', 'scotland', 'wales'))</code>
will produced a trend for GB (Great Britain) as well as its constituent nations. Note that
'england', scotland' and 'wales' must appear as names of columns in <code>regional_codes</code>. 
More than one aggregate can be given, eg <code>region_aggs = list(GB = c('england', 'scotland',
 'wales'), UK = c('england', 'scotland', 'wales', 'northern_ireland'))</code>.</p></td>
    </tr>
    <tr>
      <th>additional.parameters</th>
      <td><p>A character vector of additional parameters to monitor</p></td>
    </tr>
    <tr>
      <th>additional.BUGS.elements</th>
      <td><p>A named list giving additioanl bugs elements passed 
to <code><a href='http://www.rdocumentation.org/packages/R2jags/topics/jags'>R2jags::jags</a></code> 'data' argument</p></td>
    </tr>
    <tr>
      <th>additional.init.values</th>
      <td><p>A named list giving user specified initial values to 
be added to the defaults.</p></td>
    </tr>
    <tr>
      <th>return_data</th>
      <td><p>Logical, if <code>TRUE</code> (default) the bugs data object is returned with the data</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list including the model, bugs model output, the path of the model file used and information on the number of iterations, first year, last year, etc.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function requires both the R package R2jags and the program JAGS.
These are not installed by default when sparta is loaded and so should be
installed by the user. More details can be found in teh vignette.
    <code>modeltype</code> is used to choose the model as well as the initial values,
and the parameter to monitor. There are 9 elements that define models, however not
all combinations are available in sparta. You will get an error if you try and use
a combination that is not supported. There is usually a good reason why that
combination is not a good idea. Here are the model elements available.</p><ul>
<li><p><code>"sparta"</code> - This uses the same model as in Isaac et al (2014)</p></li>
<li><p><code>"indran"</code> - Here the prior for the year effect of the state model is modelled as a random effect.  This allows the model to adapt to interannual variability.</p></li>
<li><p><code>"inversegamma"</code> - Includes inverse-gamma hyperpriors for random effects within the model</p></li>
<li><p><code>"intercept"</code> - Includes an intercept term in the state and observation model.  By including intercept terms, the occupancy and detection probabilities in each year are centred on an overall mean level.</p></li>
<li><p><code>"centering"</code> - Includes hierarchical centering of the model parameters.   Centring does not change the model explicitly but writes it in a way that allows parameter estimates to be updated simultaneously.</p></li>
<li><p><code>"ranwalk"</code> - Here the prior for the year effect of the state model is modelled as a random walk.  Each estimate for the year effect is dependent on that of the previous year.</p></li>
<li><p><code>"halfcauchy"</code> - Includes half-Cauchy hyperpriors for all random effects within the model.  The half-Cauchy is a special case of the Student’s t distribution with 1 degree of freedom.</p></li>
<li><p><code>"catlistlength"</code> - This specifies that list length should be considered as a catagorical variable. There are 3 classes, lists of length 1, 2-3, and 4 and over. If none of the list length options are specifed 'contlistlength' is used</p></li>
<li><p><code>"contlistlength"</code> - This specifies that list length should be considered as a continious variable. If none of the list length options are specifed 'contlistlength' is used</p></li>
<li><p><code>"nolistlength"</code> - This specifies that no list length should be used. If none of the list length options are specifed 'contlistlength' is used</p></li>
<li><p><code>"jul_date"</code> - This adds Julian date to the model as a polynomial centered on the middle of the year. Note your data must include Julian day (use formatOccData(..., includeJDay = TRUE))</p></li>
</ul><p>These options are provided as a vector of characters, e.g. <code>modeltype = c('indran', 'centering', 'halfcauchy', 'catlistlength')</code></p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Isaac, N.J.B., van Strien, A.J., August, T.A., de Zeeuw, M.P. and Roy, D.B. (2014).
            Statistics for citizen science: extracting signals of change from noisy ecological data.
            Methods in Ecology and Evolution, 5 (10), 1052-1060.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># Create data</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>15000</span> <span class='co'>#size of dataset</span>
<span class='no'>nyr</span> <span class='kw'>&lt;-</span> <span class='fl'>20</span> <span class='co'># number of years in data</span>
<span class='no'>nSamples</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span> <span class='co'># set number of dates</span>
<span class='no'>nSites</span> <span class='kw'>&lt;-</span> <span class='fl'>50</span> <span class='co'># set number of sites</span>

<span class='co'># Create somes dates</span>
<span class='no'>first</span> <span class='kw'>&lt;-</span> <span class='fu'>as.Date</span>(<span class='fu'>strptime</span>(<span class='st'>"2010/01/01"</span>, <span class='st'>"%Y/%m/%d"</span>))
<span class='no'>last</span> <span class='kw'>&lt;-</span> <span class='fu'>as.Date</span>(<span class='fu'>strptime</span>(<span class='fu'>paste</span>(<span class='fl'>2010</span>+(<span class='no'>nyr</span>-<span class='fl'>1</span>),<span class='st'>"/12/31"</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>''</span>), <span class='st'>"%Y/%m/%d"</span>))
<span class='no'>dt</span> <span class='kw'>&lt;-</span> <span class='no'>last</span>-<span class='no'>first</span>
<span class='no'>rDates</span> <span class='kw'>&lt;-</span> <span class='no'>first</span> + (<span class='fu'>runif</span>(<span class='no'>nSamples</span>)*<span class='no'>dt</span>)

<span class='co'># taxa are set as random letters</span>
<span class='no'>taxa</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='no'>letters</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='no'>n</span>, <span class='fl'>TRUE</span>)

<span class='co'># sites are visited randomly</span>
<span class='no'>site</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='fu'>paste</span>(<span class='st'>'A'</span>, <span class='fl'>1</span>:<span class='no'>nSites</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>''</span>), <span class='kw'>size</span> <span class='kw'>=</span> <span class='no'>n</span>, <span class='fl'>TRUE</span>)

<span class='co'># the date of visit is selected at random from those created earlier</span>
<span class='no'>time_period</span> <span class='kw'>&lt;-</span> <span class='fu'>sample</span>(<span class='no'>rDates</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='no'>n</span>, <span class='fl'>TRUE</span>)

<span class='co'># Format the data</span>
<span class='no'>visitData</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='formatOccData.html'>formatOccData</a></span>(<span class='kw'>taxa</span> <span class='kw'>=</span> <span class='no'>taxa</span>, <span class='kw'>site</span> <span class='kw'>=</span> <span class='no'>site</span>, <span class='kw'>time_period</span> <span class='kw'>=</span> <span class='no'>time_period</span>)

<span class='co'># run the model with these data for one species (very small number of iterations)</span>
<span class='no'>results</span> <span class='kw'>&lt;-</span> <span class='fu'>occDetFunc</span>(<span class='kw'>taxa_name</span> <span class='kw'>=</span> <span class='no'>taxa</span>[<span class='fl'>1</span>],
                      <span class='kw'>n_iterations</span> <span class='kw'>=</span> <span class='fl'>50</span>,
                      <span class='kw'>burnin</span> <span class='kw'>=</span> <span class='fl'>15</span>,
                      <span class='kw'>occDetdata</span> <span class='kw'>=</span> <span class='no'>visitData</span>$<span class='no'>occDetdata</span>,
                      <span class='kw'>spp_vis</span> <span class='kw'>=</span> <span class='no'>visitData</span>$<span class='no'>spp_vis</span>,
                      <span class='kw'>write_results</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Tom August, Gary Powney, Charlie Outhwaite, Colin Harrower, Mark Hill, Nick Isaac.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
